<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Login Register form</title>

<!-- Boxicons CDN -->
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"/>
<!-- Custom CSS -->
<link href="login.css" rel="stylesheet">

<style>
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(40px); }
  to   { opacity: 1; transform: translateY(0); }
}
.wrapper { animation: fadeInUp 0.8s ease-out both; }

.language-switch {
  position: absolute;
  top: 20px;
  left: 30px;
  z-index: 99;
}

/* ===== Mobile-friendly overrides (เพิ่มส่วนนี้) ===== */
@media (max-width: 768px) {
  /* จัดหน้าให้เริ่มจากบน และเว้นพื้นที่ปุ่มบน */
  body{
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    padding-top: max(64px, env(safe-area-inset-top));
    background: #f7fafb;
  }

  /* ปุ่มภาษา + ปุ่มกลับ ให้อยู่มุมบนแบบ fixed */
  .language-switch{ position: fixed; top: 12px; left: 12px; z-index: 99; }
  .back-home-button{ position: fixed !important; top: 12px !important; right: 12px !important; z-index: 99; }

  /* กล่องหลักให้กว้างเต็มจอ สูงอัตโนมัติ ไม่ลอย */
  .wrapper{
    width: 100%;
    max-width: 520px;
    height: auto;
    margin: 0 auto 24px;
    border-radius: 16px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 6px 24px rgba(0,0,0,.08);
    overflow: hidden;
  }

  /* ตัดพื้นหลังลายเอียงออกบนมือถือ */
  .wrapper .rotate-bg,
  .wrapper .rotate-bg2{
    display: none;
  }

  /* ฟอร์มให้เรียงเป็นคอลัมน์เดียว กินเต็มพื้นที่ */
  .wrapper .form-box{
    position: static;
    width: 100%;
    height: auto;
    padding: 24px 18px;
    display: none; /* ซ่อนก่อน แล้วค่อยโชว์เฉพาะอันที่ใช้งาน */
    flex-direction: column;
    justify-content: center;
  }

  /* แสดงเฉพาะกล่องที่ใช้งาน (login หรือ register) */
  .wrapper:not(.active) .form-box.login{ display: flex; }
  .wrapper.active .form-box.register{ display: flex; }

  /* ซ่อนกล่องข้อความด้านขวาในมือถือ เพื่อไม่ให้แน่น */
  .wrapper .info-text{ display: none; }

  /* ลด/ปิดเอฟเฟกต์เลื่อนบนมือถือให้ภาพนิ่งไม่ลอย */
  .wrapper .form-box .animation{
    transform: none !important;
    filter: none !important;
    opacity: 1 !important;
    transition: none !important;
  }

  /* ช่องกรอก/ปุ่มให้แตะง่ายและไม่เกิดการซูมใน iOS */
  .input-box input{
    font-size: 16px;   /* ≥16px ป้องกัน iOS auto-zoom */
    padding-right: 28px;
  }
  form button{
    width: 100%;
    height: 48px;
    font-size: 16px;
    border-radius: 12px;
  }

  /* ระยะห่างข้อความลิงก์ */
  form .linkTxt{
    margin: 16px 0 0;
    text-align: center;
  }
}

/* จอเล็กมาก */
@media (max-width: 360px){
  .wrapper{ max-width: 94vw; }
  .language-switch select{ transform: scale(.95); }
}
</style>
</head>
<body>

<!-- Language Switch -->
<div class="language-switch">
  <select id="langSelect" onchange="switchLang()" style="padding: 6px 12px; border-radius: 20px; border: 1px solid #ccc; color: #10b981;">
    <option value="th">ไทย</option>
    <option value="en">English</option>
  </select>
</div>

<!-- Back to Home -->
<a class="back-home-button" href="index.html" style="position: absolute; top: 20px; right: 30px; z-index: 99; text-decoration: none;">
  <span id="btn-back" style="background-color: #10b981; color: white; padding: 8px 16px; border: none; border-radius: 20px; font-size: 0.9rem; cursor: pointer;">
    Back to Home
  </span>
</a>

<!-- Wrapper -->
<div class="wrapper">
  <span class="rotate-bg"></span>
  <span class="rotate-bg2"></span>

  <!-- Login Box -->
  <div class="form-box login active">
    <h2 class="title animation" style="--i:0; --j:21" id="login-title">Login</h2>
    <form action="login.php" method="POST">
      <div class="input-box animation" style="--i:1; --j:22">
        <input name="email" required type="email"/>
        <label id="label-email">Email</label>
        <i class="bx bxs-user"></i>
      </div>
      <div class="input-box animation" style="--i:2; --j:23">
        <input name="password" required type="password"/>
        <label id="label-password">Password</label>
        <i class="bx bxs-lock-alt"></i>
        <div id="login-error" style="color: red; font-size: 0.9rem; margin-top: 4px; display: none;"></div>
      </div>
      <button class="btn animation" style="--i:3; --j:24" type="submit" id="btn-login">Login</button>
      <div class="linkTxt animation" style="--i:5; --j:25">
        <p id="no-account">Don't have an account? <a class="register-link" href="#">Sign Up</a></p>
      </div>
    </form>
  </div>

  <div class="info-text login">
    <h2 class="animation" style="--i:0; --j:20" id="login-welcome">Welcome!</h2>
    <p class="animation" style="--i:1; --j:21" id="login-subtext">
      Manage your money and future<br/>
      With simple and practical financial knowledge
    </p>
  </div>

  <!-- Register -->
  <div class="form-box register active">
    <h2 class="title animation" style="--i:17; --j:0" id="signup-title">Sign Up</h2>
    <form action="register.php" method="POST">
      <div class="input-box animation" style="--i:18; --j:1">
        <input name="username" required type="text"/>
        <label id="label-username">Username</label>
        <i class="bx bxs-user"></i>
      </div>
      <div class="input-box animation" style="--i:19; --j:2">
        <input name="email" required type="email"/>
        <label>Email</label>
        <i class="bx bxs-envelope"></i>
      </div>
      <div class="input-box animation" style="--i:20; --j:3">
        <input name="password" required type="password"/>
        <label>Password</label>
        <i class="bx bxs-lock-alt"></i>
      </div>
      <button class="btn animation" style="--i:21;--j:4" type="submit" id="btn-signup">Sign Up</button>
      <div class="linkTxt animation" style="--i:22; --j:5">
        <p id="have-account">Already have an account? <a class="login-link" href="#">Login</a></p>
      </div>
    </form>
  </div>

  <div class="info-text register">
    <h2 class="animation" style="--i:17; --j:0;" id="signup-welcome">Start your financial journey</h2>
    <p class="animation" style="--i:18; --j:1;" id="signup-subtext">
      Create an account and take control of your money with ease.
    </p>
  </div>
</div>

<script src="script.js"></script>

<script>
const texts = {
  en: {
    loginTitle: "Login",
    emailLabel: "Email",
    passwordLabel: "Password",
    loginButton: "Login",
    noAccount: `Don't have an account? <a class="register-link" href="#">Sign Up</a>`,
    loginWelcome: "WELCOME!",
    loginSubtext: `Manage your money and future<br>With simple and practical financial knowledge`,
    signupTitle: "Sign Up",
    usernameLabel: "Username",
    signupButton: "Sign Up",
    haveAccount: `Already have an account? <a class="login-link" href="#">Login</a>`,
    signupWelcome: "Start your financial journey",
    signupSubtext: `Create an account and take control of your money with ease`,
    backButton: "Back to Home",
    err_required: "Please enter email and password.",
    err_email: "Please enter a valid email address.",
    err_password_len: "Password must be at least 6 characters.",
    err_invalid: "Incorrect email or password.",
    err_locked: "Your account is locked. Please contact support.",
    err_unknown: "Something went wrong. Please try again."
  },
  th: {
    loginTitle: "เข้าสู่ระบบ",
    emailLabel: "อีเมล",
    passwordLabel: "รหัสผ่าน",
    loginButton: "เข้าสู่ระบบ",
    noAccount: `ยังไม่มีบัญชี? <a class="register-link" href="#">สมัครสมาชิก</a>`,
    loginWelcome: "ยินดีต้อนรับ!",
    loginSubtext: `จัดการการเงินและอนาคตของคุณ<br>ด้วยความรู้ทางการเงินที่เข้าใจง่าย`,
    signupTitle: "สมัครสมาชิก",
    usernameLabel: "ชื่อผู้ใช้",
    signupButton: "สมัครสมาชิก",
    haveAccount: `มีบัญชีอยู่แล้ว? <a class="login-link" href="#">เข้าสู่ระบบ</a>`,
    signupWelcome: "เริ่มต้นเส้นทางการเงินของคุณ",
    signupSubtext: `สร้างบัญชีเพื่อควบคุมการเงินของคุณได้อย่างง่ายดาย`,
    backButton: "กลับหน้าแรก",
    err_required: "กรุณากรอกอีเมลและรหัสผ่าน",
    err_email: "กรุณากรอกอีเมลให้ถูกต้อง",
    err_password_len: "รหัสผ่านต้องมีความยาวอย่างน้อย 6 ตัวอักษร",
    err_invalid: "อีเมลหรือรหัสผ่านไม่ถูกต้อง",
    err_locked: "บัญชีถูกระงับการใช้งาน กรุณาติดต่อเจ้าหน้าที่",
    err_unknown: "เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง"
  }
};

function bindAuthSwitch() {
  const wrapper = document.querySelector(".wrapper");
  const reg = document.querySelector(".register-link");
  const login = document.querySelector(".login-link");
  if (reg) reg.onclick = (e)=>{ e.preventDefault(); wrapper.classList.add("active"); };
  if (login) login.onclick = (e)=>{ e.preventDefault(); wrapper.classList.remove("active"); };
}

function switchLang() {
  const lang = document.getElementById("langSelect").value;
  localStorage.setItem("lang", lang);
  const t = texts[lang];

  document.getElementById("login-title").innerText = t.loginTitle;
  document.getElementById("label-email").innerText = t.emailLabel;
  document.getElementById("label-password").innerText = t.passwordLabel;
  document.getElementById("btn-login").innerText = t.loginButton;
  document.getElementById("no-account").innerHTML = t.noAccount;
  document.getElementById("login-welcome").innerText = t.loginWelcome;
  document.getElementById("login-subtext").innerHTML = t.loginSubtext;

  document.getElementById("signup-title").innerText = t.signupTitle;
  document.getElementById("label-username").innerText = t.usernameLabel;
  document.getElementById("btn-signup").innerText = t.signupButton;
  document.getElementById("have-account").innerHTML = t.haveAccount;
  document.getElementById("signup-welcome").innerText = t.signupWelcome;
  document.getElementById("signup-subtext").innerHTML = t.signupSubtext;

  document.getElementById("btn-back").innerText = t.backButton;

  hideLoginError();
  bindAuthSwitch();
}

/* -------- Error helpers -------- */
function showLoginError(keyOrText) {
  const lang = localStorage.getItem("lang") || "en";
  const t = texts[lang];
  const msg = t[keyOrText] || keyOrText || t.err_unknown;
  const box = document.getElementById("login-error");
  if (!box) return;
  box.innerText = msg;
  box.style.display = "block";
  box.style.animation = "shake 0.3s";
  setTimeout(()=> box.style.animation = "", 300);
}
function hideLoginError() {
  const box = document.getElementById("login-error");
  if (!box) return;
  box.innerText = "";
  box.style.display = "none";
}

/* -------- Client validation -------- */
function isValidEmail(email){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }

document.addEventListener("DOMContentLoaded", () => {
  const lang = localStorage.getItem("lang") || "en";
  document.getElementById("langSelect").value = lang;
  document.getElementById("btn-back").innerText = texts[lang].backButton;
  switchLang();

  const loginForm = document.querySelector(".form-box.login form");
  if (loginForm) {
    loginForm.setAttribute("novalidate", "novalidate");
    loginForm.addEventListener("submit", (e)=>{
      hideLoginError();
      const formData = new FormData(loginForm);
      const email = (formData.get("email") || "").toString().trim();
      const password = (formData.get("password") || "").toString();

      if (!email || !password) { e.preventDefault(); showLoginError("err_required"); return; }
      if (!isValidEmail(email)) { e.preventDefault(); showLoginError("err_email"); return; }
      if (password.length < 6) { e.preventDefault(); showLoginError("err_password_len"); return; }
    });
  }

  const params = new URLSearchParams(location.search);
  const error = params.get("error");
  if (error) {
    if (["invalid","locked","unknown"].includes(error)) {
      showLoginError(`err_${error}`);
    } else {
      showLoginError(decodeURIComponent(error));
    }
  }

  bindAuthSwitch();
});

/* เอฟเฟกต์สั่นนิด ๆ เมื่อขึ้น error */
const style = document.createElement('style');
style.textContent = `
@keyframes shake {
  0% { transform: translateX(0) }
  25% { transform: translateX(-3px) }
  50% { transform: translateX(3px) }
  75% { transform: translateX(-2px) }
  100% { transform: translateX(0) }
}
`;
document.head.appendChild(style);
</script>

</body>
</html>
